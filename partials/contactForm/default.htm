[viewBag]
==
<?php
// TODO wird diese funktion zweimal aufgerufen?
function onMailSent() {
    die;
    $formVars = [
        'receivermail' => post('receivermail'),
        'receivername' => post('receivername'),
        'succeesstext' => post('succeesstext'),
        'receiverregard' => post('receiverregard'),
        'mailtemplate' => post('mailtemplate'),
        'name' => post('name'),
        'email' => post('email'),
        'regard' => post('regard'),
        'sendermessage' => post('message'),
    ];
    
    $formVars['receiverregard'] = str_replace("{{name}}", $formVars['name'], $formVars['receiverregard']);
    $formVars['receiverregard'] = str_replace("{{regard}}", $formVars['regard'], $formVars['receiverregard']);
    
    $buildOwnerMessage = function ($message) use ($formVars) {
        // TODO use email and name from backend or theme settings
        $message->to($formVars['receivermail'], $formVars['receivername']);
        $message->subject($formVars['receiverregard']);
    };

    // mail to site owner
    Mail::send($formVars['mailtemplate'], $formVars, $buildOwnerMessage);
      
    $this['result'] = $formVars['succeesstext'];
}
?>
==
<div class="confirm-container">
    <!--This will contain the confirmation when the email is successfully sent-->
</div>
<form class="csontactForm" role="form"
      data-request="onMailSent"
      data-request-update="'contactForm/confirm': '.confirm-container'"
      data-request-data="receivermail: '{{this.theme.email_address}}', receivername:'{{this.theme.company_name}}', succeesstext: '{{this.theme.contact_succeess_text}}', receiverregard: '{{this.theme.contact_regard}}', mailtemplate: '{{this.theme.mail_template}}'"
      >
    <div class="form-groups">
        <div class="form-group">
            <input type="text" class="form-control" name="name" required placeholder="Name">
        </div>
        <div class="form-group">
            <input type="email" class="form-control" name="email" required placeholder="Email">
        </div>
        <div class="form-group">
            <input type="text" class="form-control" name="regard" required placeholder="Regard">
        </div>
        <fieldset class="form-group">
            <textarea class="form-control" name="message" rows="6" required placeholder="Your message to us"></textarea>
        </fieldset>
        {% if __SELF__.enableCaptcha %}
            <div class="form-group">
                <div class="g-recaptcha" data-sitekey="{{ __SELF__.siteKey }}"></div>
            </div>
        {% endif %}
        <div class="d-flex align-items-end flex-column">
            <button type="submit" class="btn">Send</button>
        </div> 
    </div>
</form>